{% extends 'base.html' %}
{% load static i18n %}

{% block title %}{{user.username}}'s Profile - MitsuList{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto; padding: 40px 20px;">

    <!-- Profile Header -->
    <!-- Profile Header -->
    <div
        style="display: flex; flex-direction: column; md:flex-row; gap: 30px; margin-bottom: 40px; background: var(--glass-bg); padding: 30px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1);">
        <div style="display: flex; gap: 30px; align-items: flex-start;">
            <div
                style="width: 120px; height: 120px; border-radius: 50%; overflow: hidden; border: 3px solid var(--color-primary); flex-shrink: 0;">
                <img src="{{ viewed_user.profile.image.url }}" alt="{{ viewed_user.username }}"
                    style="width: 100%; height: 100%; object-fit: cover;">
            </div>
            <div style="flex-grow: 1;">
                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <h1
                        style="margin: 0; font-family: var(--font-header); font-size: 2.5rem; text-transform: uppercase;">
                        {{viewed_user.username}}
                    </h1>
                    
                    {% if is_own_profile %}
                    <a href="{% url 'edit_profile' %}"
                        style="font-size: 0.9rem; color: var(--color-muted); border: 1px solid rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 6px; text-decoration: none; transition: 0.2s;"
                        onmouseover="this.style.borderColor='white'; this.style.color='white'"
                        onmouseout="this.style.borderColor='rgba(255,255,255,0.1)'; this.style.color='var(--color-muted)'"><i
                            class="fa-solid fa-pen"></i> {% trans "Edit" %}</a>
                    {% else %}
                        {% if is_following %}
                        <a href="{% url 'unfollow_user' viewed_user.username %}"
                            style="font-size: 0.9rem; background: rgba(248, 113, 113, 0.2); color: #f87171; border: 1px solid #f87171; padding: 5px 15px; border-radius: 6px; text-decoration: none; transition: 0.2s;">
                            <i class="fa-solid fa-user-minus"></i> {% trans "Unfollow" %}
                        </a>
                        {% else %}
                        <a href="{% url 'follow_user' viewed_user.username %}"
                            style="font-size: 0.9rem; background: var(--color-primary); color: white; border: 1px solid var(--color-primary); padding: 5px 15px; border-radius: 6px; text-decoration: none; transition: 0.2s;">
                            <i class="fa-solid fa-user-plus"></i> {% trans "Follow" %}
                        </a>
                        {% endif %}
                    {% endif %}

                    {% if is_own_profile %}
                    <a href="{% url 'create_review' %}"
                        style="font-size: 0.9rem; color: var(--color-muted); border: 1px solid rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 6px; text-decoration: none; transition: 0.2s;"
                        onmouseover="this.style.borderColor='white'; this.style.color='white'"
                        onmouseout="this.style.borderColor='rgba(255,255,255,0.1)'; this.style.color='var(--color-muted)'"><i
                            class="fa-solid fa-pen-nib"></i> {% trans "Write Review" %}</a>
                    {% endif %}
                </div>

                <div style="display: flex; gap: 20px; margin-top: 10px; font-size: 0.9rem; color: var(--color-muted);">
                    <span><strong style="color: white;">{{ followers_count }}</strong> {% trans "Followers" %}</span>
                    <span><strong style="color: white;">{{ following_count }}</strong> {% trans "Following" %}</span>
                    <span>{% trans "Member since" %} {{viewed_user.date_joined|date:"F Y"}}</span>
                </div>

                <p style="color: var(--color-muted); margin-top: 5px; font-size: 0.9rem;">
                    {% if viewed_user.profile.gender != 'N' %} &bull; {{ viewed_user.profile.get_gender_display }} {% endif %}
                </p>

                {% if viewed_user.profile.bio %}
                <p style="margin-top: 15px; line-height: 1.5; color: #e2e8f0; max-width: 600px;">
                    {{ viewed_user.profile.bio }}
                </p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Shared Anime (Comparison) -->
    {% if not is_own_profile and shared_anime %}
    <div style="margin-bottom: 40px; background: var(--glass-bg); padding: 20px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1);">
        <h3 style="margin-top: 0; margin-bottom: 15px; color: var(--color-accent); font-family: var(--font-header);">
            <i class="fa-solid fa-handshake-simple"></i> {% trans "SHARED ANIME" %}
        </h3>
        <p style="color: var(--color-muted); font-size: 0.9rem; margin-bottom: 15px;">
            {% trans "You both watched" %}:
        </p>
        <div style="display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: thin;">
            {% for entry in shared_anime %}
            <a href="/anime/{{entry.anime_id}}/" title="{{entry.title}}" 
               style="flex-shrink: 0; width: 60px; height: 90px; border-radius: 8px; overflow: hidden; position: relative; border: 1px solid rgba(255,255,255,0.2);">
                <img src="{{entry.image_url}}" style="width: 100%; height: 100%; object-fit: cover;">
            </a>
            {% endfor %}
            {% if shared_anime|length >= 5 %}
            <div style="display: flex; align-items: center; justify-content: center; width: 60px; height: 90px; background: rgba(255,255,255,0.05); border-radius: 8px; color: var(--color-muted); font-size: 0.8rem;">
                + more
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Lists Container -->
    <div
        style="background: var(--glass-bg); border-radius: 16px; border: 1px solid rgba(255,255,255,0.05); overflow: hidden;">
        <!-- Tabs -->
        <div style="display: flex; border-bottom: 1px solid rgba(255,255,255,0.1);">
            <button class="list-tab active" data-tab="all"
                style="padding: 15px 30px; background: transparent; border: none; color: white; font-family: var(--font-header); cursor: pointer; border-bottom: 3px solid var(--color-primary);">{% trans "ALL" %}</button>
            <button class="list-tab" data-tab="watching"
                style="padding: 15px 30px; background: transparent; border: none; color: var(--color-muted); font-family: var(--font-header); cursor: pointer; border-bottom: 3px solid transparent;">{% trans "WATCHING" %}</button>
            <button class="list-tab" data-tab="completed"
                style="padding: 15px 30px; background: transparent; border: none; color: var(--color-muted); font-family: var(--font-header); cursor: pointer; border-bottom: 3px solid transparent;">{% trans "COMPLETED" %}</button>
            <button class="list-tab" data-tab="plan_to_watch"
                style="padding: 15px 30px; background: transparent; border: none; color: var(--color-muted); font-family: var(--font-header); cursor: pointer; border-bottom: 3px solid transparent;">
                {% trans "PLAN TO WATCH" %}</button>
        </div>

        <!-- List Content -->
        <div style="padding: 20px;">
            {% if anime_entries %}
            <div class="list-grid"
                style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px;">
                {% for entry in anime_entries %}
                <div class="anime-card entry-item" data-status="{{entry.status}}"
                    style="background: rgba(0,0,0,0.2); border-radius: 12px; overflow: hidden; transition: 0.2s;">
                    <a href="/anime/{{entry.anime_id}}/" style="text-decoration: none; color: white; display: block;">
                        <div style="height: 280px; overflow: hidden;">
                            <img src="{{entry.image_url}}"
                                style="width: 100%; height: 100%; object-fit: cover; transition: 0.3s;"
                                class="card-img">
                        </div>
                        <div style="padding: 15px;">
                            <h4
                                style="margin: 0 0 5px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                {{entry.title}}</h4>
                            <div
                                style="display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--color-muted);">
                                <span><i class="fa-solid fa-star" style="color: gold;"></i> {{entry.score}}</span>
                                <span>{{entry.episodes_watched}} eps</span>
                            </div>
                            <div
                                style="margin-top: 10px; font-size: 0.7rem; text-transform: uppercase; font-weight: bold; 
                                color: {% if entry.status == 'watching' %}#a78bfa{% elif entry.status == 'completed' %}#4ade80{% elif entry.status == 'dropped' %}#f87171{% else %}#94a3b8{% endif %};">
                                {{entry.get_status_display}}
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div style="text-align: center; padding: 50px; color: var(--color-muted);">
                <h2>{% trans "Your list is empty" %}</h2>
                <p>{% trans "Go start your journey!" %}</p>
                <a href="{% url 'home' %}" class="mitsulist-btn-primary"
                    style="text-decoration: none; display: inline-block; margin-top: 20px;">{% trans "Explore Anime" %}</a>
            </div>
            {% endif %}
            
            <!-- Pagination -->
            {% if anime_entries.has_other_pages %}
            <div style="display: flex; justify-content: center; gap: 10px; margin-top: 30px; padding: 20px 0;">
                {% if anime_entries.has_previous %}
                <a href="?page={{ anime_entries.previous_page_number }}" 
                   style="padding: 10px 20px; background: var(--glass-bg); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white; text-decoration: none; transition: 0.2s;"
                   onmouseover="this.style.borderColor='var(--color-primary)'" onmouseout="this.style.borderColor='rgba(255,255,255,0.1)'">
                    <i class="fa-solid fa-chevron-left"></i> {% trans "Previous" %}
                </a>
                {% endif %}
                
                <span style="padding: 10px 20px; color: var(--color-muted);">
                    {% trans "Page" %} {{ anime_entries.number }} {% trans "of" %} {{ anime_entries.paginator.num_pages }}
                </span>
                
                {% if anime_entries.has_next %}
                <a href="?page={{ anime_entries.next_page_number }}" 
                   style="padding: 10px 20px; background: var(--glass-bg); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white; text-decoration: none; transition: 0.2s;"
                   onmouseover="this.style.borderColor='var(--color-primary)'" onmouseout="this.style.borderColor='rgba(255,255,255,0.1)'">
                    {% trans "Next" %} <i class="fa-solid fa-chevron-right"></i>
                </a>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const tabs = document.querySelectorAll(".list-tab");
        const items = document.querySelectorAll(".entry-item");

        tabs.forEach(tab => {
            tab.addEventListener("click", () => {
                // Update tabs
                tabs.forEach(t => {
                    t.classList.remove("active");
                    t.style.color = "var(--color-muted)";
                    t.style.borderBottom = "3px solid transparent";
                });
                tab.classList.add("active");
                tab.style.color = "white";
                tab.style.borderBottom = "3px solid var(--color-primary)";

                // Filter items
                const status = tab.dataset.tab;
                items.forEach(item => {
                    if (status === "all" || item.dataset.status === status) {
                        item.style.display = "block";
                    } else {
                        item.style.display = "none";
                    }
                });
            });
        });
    });
</script>

<style>
    .card-img:hover {
        transform: scale(1.05);
    }
</style>
{% endblock %}